<!DOCTYPE html>
<html>
  <head>
    <title>Maps</title>
    <style>
      #map {
        height: 500px;
        width: 800px;
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
        let map;
        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 46.227638, lng: 2.213749 }, // Centre de la France
                zoom: 6,
                mapTypeId: 'terrain', // Mode plan avec relief
                streetViewControl: false, // Désactive la vue de rue
                zoomControl: false, // Désactive le contrôle de zoom
                mapTypeControl: false, // Désactive le contrôle de type de carte
                disableDefaultUI: true // Désactive les éléments de l'interface utilisateur par défaut
            });

            // Ajout d'un événement de clic à la carte
            google.maps.event.addListener(map, 'click', function(event) {
                // Récupération des coordonnées du clic
                let lat = event.latLng.lat();
                let lng = event.latLng.lng();

                // Affichage d'un marqueur à l'emplacement du clic
                let marker = new google.maps.Marker({
                position: { lat: lat, lng: lng },
                map: map,
                });
            });
        }

        fetch('/api/pings')
        .then(response => response.json())
        .then(pings => {
            console.log(pings);
            for (let ping of pings) {
                console.log(ping)
                let lat = parseFloat(ping.lat.replace(',', '.'));
                let lng = parseFloat(ping.lng.replace(',', '.'));
                if (lat >= -90 && lat <= 90 && lng >= -180 && lng <= 180) {
                    let marker = new google.maps.Marker({
                    position: { lat, lng },
                    map: map,
                    });
                } else {
                    console.error(`Coordonnées invalides : ${lat}, ${lng}`);
                }
            }
        });
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDPeDO6qN2NYGOmV-LSQ3Tc7oSlCrJG1-I&callback=initMap"></script>
  </body>
</html>